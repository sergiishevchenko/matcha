{% if total_pages > 1 %}
<nav class="pagination">
    {% if page > 1 %}
    <a href="{{ url_for(request.endpoint, page=page-1, **request.args.to_dict(flat=True)|reject('equalto', 'page')|list|batch(2)|map('join', '=')|join('&')) }}" class="page-link">&laquo; Prev</a>
    {% endif %}

    {% set start_page = [1, page - 2]|max %}
    {% set end_page = [total_pages, page + 2]|min %}

    {% if start_page > 1 %}
    <a href="{{ url_for(request.endpoint, page=1, **dict(request.args)) }}" class="page-link">1</a>
    {% if start_page > 2 %}<span class="page-ellipsis">...</span>{% endif %}
    {% endif %}

    {% for p in range(start_page, end_page + 1) %}
    {% if p == page %}
    <span class="page-link current">{{ p }}</span>
    {% else %}
    <a href="{{ url_for(request.endpoint, page=p, **dict(request.args)) }}" class="page-link">{{ p }}</a>
    {% endif %}
    {% endfor %}

    {% if end_page < total_pages %}
    {% if end_page < total_pages - 1 %}<span class="page-ellipsis">...</span>{% endif %}
    <a href="{{ url_for(request.endpoint, page=total_pages, **dict(request.args)) }}" class="page-link">{{ total_pages }}</a>
    {% endif %}

    {% if page < total_pages %}
    <a href="{{ url_for(request.endpoint, page=page+1, **dict(request.args)) }}" class="page-link">Next &raquo;</a>
    {% endif %}
</nav>
{% endif %}
